{% extends 'base.html' %}

{% load static %}

{% block link %}
<link rel="stylesheet" href="{% static 'css/question.css' %}">
{% endblock %}

{% block content %}
<div class="p-5">
  <h1 class="text-white text-center">Список вопросов</h1>

  <form method="GET" action="{% url 'show_questions' %}">
    <div class="input-group w-25 text-center mt-5">
      <input type="text" name="search" placeholder="Поиск студента..." class="form-control">
      <button class="btn btn-primary" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
      </button>
    </div>
  </form>
  <a href="{% url 'show_questions' %}" class="btn btn-secondary btn-sm mt-3">Все чаты <span class="badge bg-primary">{{ total_questions_count }}</span></a>
  <table class="table table-striped table-hover mt-3" id="questionsTable">
    <thead>
      <tr>
        <th scope="col" class="text-center">#ID</th>
        <th scope="col">Студент</th>
        <th scope="col">Последнее сообщение</th>
        <th scope="col" class="text-center">Статус</th>
        <th scope="col" class="text-center">Дата создания</th>
        <th scope="col" class="text-center">Эдвайзер</th>
        <th class="text-center align-items-center" scope="col">Посмотреть</th>
      </tr>
    </thead>
    <tbody>
      {% for question in questions %}
      <tr>
        <th scope="row" class="text-center">{{ question.id }}</th>
        <td>
          {{ question.student.full_name }} 
          {% if question.is_closed %}
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16">
            <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
          </svg>
          {% endif %}
        </td>
        <td>
          {{ question.last_message|slice:":25" }}
        </td>
        <td class="text-center">
          {% if question.status == 'NEW' %}
            Новая
          {% elif question.status == 'IN_PROCESS' %}
            В обработке
          {% elif question.status == 'MAIN_ADVISOR' %}
            В обработке у главы ЭЦ
          {% else %}
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16">
              <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
            </svg>
          {% endif %}
        </td>
        <td class="text-center">{{ question.created_at }}</td>
        <td class="text-center">{{ question.assigned_user }}</td>
        <td class="text-center align-items-center"><a href="{% url 'view_question' question.id %}"><i class="fas fa-eye"></i></a></td>
      </tr>
      {% empty %}
      <h1 class="text-white text-center my-4">Нет новых вопросов</h1>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}

{% block script %}
  <script src="{% static 'js/question.js' %}"></script>
{% endblock %}